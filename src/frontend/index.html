<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VocaLevel â€” èªå½™ãƒ¬ãƒ™ãƒ«ãƒã‚§ãƒƒã‚«ãƒ¼</title>
<style>
/* â”€â”€ RESET â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

/* â”€â”€ VARIABLES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
:root {
  --bg:      #F8F9FA;
  --surface: #FFFFFF;
  --border:  #E5E7EB;
  --border-focus: #6366F1;

  --txt-1: #111827;
  --txt-2: #374151;
  --txt-3: #6B7280;
  --txt-4: #9CA3AF;

  --accent:   #6366F1;
  --accent-h: #4F46E5;
  --accent-bg: rgba(99,102,241,.07);

  /* Level colors */
  --n5: #16A34A; --n5-bg: #F0FDF4;
  --n4: #65A30D; --n4-bg: #F7FEE7;
  --n3: #D97706; --n3-bg: #FFFBEB;
  --n2: #EA580C; --n2-bg: #FFF7ED;
  --n1: #DC2626; --n1-bg: #FEF2F2;
  --t6: #9333EA; --t6-bg: #FAF5FF;
  --gram: #6B7280; --gram-bg: #F9FAFB;
  --unk:  #9CA3AF; --unk-bg:  #F9FAFB;

  --radius: 10px;
  --shadow: 0 1px 3px rgba(0,0,0,.06), 0 1px 2px rgba(0,0,0,.04);
  --shadow-md: 0 4px 6px rgba(0,0,0,.06), 0 2px 4px rgba(0,0,0,.04);
}

/* â”€â”€ BASE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
body {
  font-family: -apple-system, BlinkMacSystemFont, "Inter", "Segoe UI", sans-serif;
  background: var(--bg);
  color: var(--txt-1);
  min-height: 100vh;
  font-size: 14px;
  line-height: 1.6;
  -webkit-font-smoothing: antialiased;
}

/* â”€â”€ HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.hdr {
  background: var(--surface);
  border-bottom: 1px solid var(--border);
  height: 56px;
  display: flex; align-items: center; justify-content: space-between;
  padding: 0 24px;
  position: sticky; top: 0; z-index: 100;
  box-shadow: var(--shadow);
}
.logo { display: flex; align-items: center; gap: 10px; text-decoration: none; }
.logo-ico {
  width: 32px; height: 32px;
  background: var(--accent-bg);
  border-radius: 8px;
  display: flex; align-items: center; justify-content: center;
  font-size: 16px;
}
.logo-name {
  font-size: 15px; font-weight: 700;
  color: var(--txt-1);
  letter-spacing: -.3px;
}
.logo-dot { color: var(--accent); }
.hdr-right { display: flex; align-items: center; gap: 8px; }
.icon-btn {
  width: 34px; height: 34px;
  border: 1px solid var(--border);
  background: transparent;
  border-radius: 8px;
  color: var(--txt-3);
  cursor: pointer; font-size: 14px;
  display: flex; align-items: center; justify-content: center;
  transition: background .15s, border-color .15s, color .15s;
}
.icon-btn:hover { background: var(--bg); border-color: #D1D5DB; color: var(--txt-2); }

/* â”€â”€ MAIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
main { max-width: 800px; margin: 0 auto; padding: 28px 16px 72px; }

/* â”€â”€ CARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 20px;
  margin-bottom: 12px;
  box-shadow: var(--shadow);
}

/* â”€â”€ LANG TABS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.lang-tabs {
  display: inline-flex;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 3px;
  gap: 2px;
  margin-bottom: 14px;
}
.ltab {
  padding: 5px 14px;
  border: none; background: transparent;
  color: var(--txt-3); font-size: 13px; font-weight: 500;
  border-radius: 6px;
  cursor: pointer; transition: all .15s;
  display: flex; align-items: center; gap: 5px;
}
.ltab:hover { color: var(--txt-2); background: rgba(0,0,0,.04); }
.ltab.on {
  background: var(--surface);
  color: var(--accent);
  font-weight: 600;
  box-shadow: var(--shadow);
}

/* â”€â”€ TEXTAREA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.inp {
  width: 100%; min-height: 110px; padding: 11px 14px;
  border: 1px solid var(--border);
  border-radius: 8px;
  font: 15px/1.7 inherit; resize: vertical;
  background: var(--surface); color: var(--txt-1); outline: none;
  transition: border-color .15s, box-shadow .15s;
}
.inp:focus {
  border-color: var(--border-focus);
  box-shadow: 0 0 0 3px rgba(99,102,241,.12);
}
.inp::placeholder { color: var(--txt-4); }

.inp-foot {
  display: flex; justify-content: space-between; align-items: center;
  margin-top: 10px; gap: 8px;
}
.inp-left { display: flex; align-items: center; gap: 8px; }
.char-cnt { font-size: 12px; color: var(--txt-4); }
.char-cnt span { color: var(--txt-3); font-weight: 500; }
.sample-btns { display: flex; gap: 4px; }
.sample-btn {
  padding: 4px 10px;
  border: 1px solid var(--border); background: transparent;
  color: var(--txt-3); font-size: 12px; font-weight: 500;
  border-radius: 6px;
  cursor: pointer; transition: all .15s;
}
.sample-btn:hover {
  border-color: #D1D5DB; background: var(--bg); color: var(--txt-2);
}

/* â”€â”€ ANALYZE BUTTON â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.btn-go {
  padding: 8px 20px;
  background: var(--accent);
  border: none;
  border-radius: 8px;
  color: #fff;
  font: 600 13px/1 inherit;
  letter-spacing: .2px;
  cursor: pointer;
  display: flex; align-items: center; gap: 7px;
  box-shadow: 0 1px 2px rgba(99,102,241,.25), 0 0 0 0 rgba(99,102,241,.0);
  transition: background .15s, box-shadow .15s, transform .1s;
}
.btn-go:hover:not(:disabled) {
  background: var(--accent-h);
  box-shadow: 0 2px 8px rgba(99,102,241,.35);
}
.btn-go:active:not(:disabled) { transform: scale(.98); }
.btn-go:disabled { opacity: .45; cursor: not-allowed; }

/* â”€â”€ CSV BUTTON â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.btn-csv {
  padding: 5px 11px;
  border: 1px solid var(--border);
  background: var(--surface);
  color: var(--txt-3);
  font: 500 12px/1 inherit;
  border-radius: 7px;
  cursor: pointer;
  display: flex; align-items: center; gap: 5px;
  transition: all .15s;
  white-space: nowrap;
}
.btn-csv:hover { border-color: #D1D5DB; background: var(--bg); color: var(--txt-2); }

/* â”€â”€ SPINNER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.spinner {
  width: 13px; height: 13px;
  border: 2px solid rgba(255,255,255,.3);
  border-top-color: #fff;
  border-radius: 50%;
  animation: spin .6s linear infinite;
}
@keyframes spin { to { transform: rotate(360deg); } }

/* â”€â”€ RESULT AREA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.res-hdr {
  display: flex; justify-content: space-between; align-items: center;
  margin-bottom: 16px; gap: 12px; flex-wrap: wrap;
}
.res-title {
  font-size: 14px; font-weight: 600; color: var(--txt-1);
}
.res-sub { font-size: 12px; color: var(--txt-3); margin-top: 2px; }

.res-controls { display: flex; align-items: center; gap: 6px; }

.vtoggle {
  display: flex;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 7px;
  padding: 3px;
  gap: 2px;
}
.vbtn {
  padding: 4px 12px;
  border: none; background: transparent;
  color: var(--txt-3); font: 500 12px/1 inherit;
  border-radius: 5px;
  cursor: pointer; transition: all .15s;
}
.vbtn.on {
  background: var(--surface);
  color: var(--accent);
  font-weight: 600;
  box-shadow: var(--shadow);
}
.vbtn:hover:not(.on) { color: var(--txt-2); }

/* â”€â”€ DETECT BADGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.detect-badge {
  display: inline-flex; align-items: center; gap: 8px;
  padding: 5px 12px; margin-bottom: 16px;
  background: var(--accent-bg);
  border: 1px solid rgba(99,102,241,.18);
  border-radius: 6px;
  font-size: 12px; color: var(--txt-2);
}
.detect-badge b { color: var(--accent); font-weight: 600; }
.detect-badge .dot-sep { color: var(--txt-4); }

/* â”€â”€ SUMMARY STATS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.sum-row { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 18px; }
.sum-card {
  flex: 1; min-width: 80px;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 12px 14px;
}
.sum-val {
  font-size: 26px; font-weight: 700;
  color: var(--txt-1); letter-spacing: -1px; line-height: 1;
}
.sum-val.level { color: var(--accent); }
.sum-lbl {
  font-size: 10px; color: var(--txt-4); margin-top: 4px;
  font-weight: 500; letter-spacing: .2px;
  line-height: 1.5;
}

/* â”€â”€ TOKEN DISPLAY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.tok-wrap {
  display: flex; flex-wrap: wrap; gap: 8px 4px; align-items: flex-start;
  padding: 4px 0;
}
.tok {
  display: flex; flex-direction: column; align-items: center;
  cursor: default; position: relative; user-select: none;
}
.tok-sf {
  padding: 4px 10px;
  font-size: 16px; font-weight: 600;
  border-radius: 6px;
  border: 1px solid transparent;
  transition: transform .12s, box-shadow .12s;
  line-height: 1.35; white-space: nowrap;
}
.tok:hover .tok-sf {
  transform: translateY(-2px);
  box-shadow: var(--shadow-md);
}
.tok-rd { font-size: 10px; color: var(--txt-4); margin-top: 2px; height: 13px; }
.tok-lv {
  font-size: 9px; font-weight: 700; margin-top: 2px;
  padding: 1px 5px; border-radius: 3px;
  letter-spacing: .3px;
}
.tok-pos {
  font-size: 8px; color: var(--txt-4);
  margin-top: 2px; white-space: nowrap;
  max-width: 100px; overflow: hidden; text-overflow: ellipsis;
  letter-spacing: .1px;
}

/* â”€â”€ TOOLTIP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.ttp {
  display: none; position: absolute;
  bottom: calc(100% + 8px); left: 50%; transform: translateX(-50%);
  background: var(--txt-1);
  color: #fff;
  padding: 8px 12px;
  border-radius: 8px;
  font-size: 11px; white-space: nowrap; z-index: 200;
  box-shadow: 0 8px 24px rgba(0,0,0,.15);
  pointer-events: none;
}
.ttp::after {
  content: ''; position: absolute;
  bottom: -5px; left: 50%; transform: translateX(-50%);
  border: 5px solid transparent;
  border-top-color: var(--txt-1);
  border-bottom: none;
}
.tok:hover .ttp { display: block; }
.ttp-row { display: flex; gap: 10px; padding: 1.5px 0; }
.ttp-k { color: rgba(255,255,255,.5); min-width: 80px; font-size: 10px; }
.ttp-v { color: #fff; font-weight: 600; }

/* â”€â”€ LEVEL COLORS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.lN5 .tok-sf,.lN5 .tok-lv { background:var(--n5-bg); color:var(--n5); border-color:rgba(22,163,74,.15); }
.lN4 .tok-sf,.lN4 .tok-lv { background:var(--n4-bg); color:var(--n4); border-color:rgba(101,163,13,.15); }
.lN3 .tok-sf,.lN3 .tok-lv { background:var(--n3-bg); color:var(--n3); border-color:rgba(217,119,6,.15); }
.lN2 .tok-sf,.lN2 .tok-lv { background:var(--n2-bg); color:var(--n2); border-color:rgba(234,88,12,.15); }
.lN1 .tok-sf,.lN1 .tok-lv { background:var(--n1-bg); color:var(--n1); border-color:rgba(220,38,38,.15); }
.lT1 .tok-sf,.lT1 .tok-lv { background:var(--n5-bg); color:var(--n5); border-color:rgba(22,163,74,.15); }
.lT2 .tok-sf,.lT2 .tok-lv { background:var(--n4-bg); color:var(--n4); border-color:rgba(101,163,13,.15); }
.lT3 .tok-sf,.lT3 .tok-lv { background:var(--n3-bg); color:var(--n3); border-color:rgba(217,119,6,.15); }
.lT4 .tok-sf,.lT4 .tok-lv { background:var(--n2-bg); color:var(--n2); border-color:rgba(234,88,12,.15); }
.lT5 .tok-sf,.lT5 .tok-lv { background:var(--n1-bg); color:var(--n1); border-color:rgba(220,38,38,.15); }
.lT6 .tok-sf,.lT6 .tok-lv { background:var(--t6-bg); color:var(--t6); border-color:rgba(147,51,234,.15); }
.lGR .tok-sf,.lGR .tok-lv { background:var(--gram-bg); color:var(--gram); border-color:var(--border); }
.lUK .tok-sf,.lUK .tok-lv { background:var(--unk-bg);  color:var(--unk);  border-color:var(--border); }

/* â”€â”€ TRANSLATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.trans-sec { margin-top: 20px; padding-top: 18px; border-top: 1px solid var(--border); }
.trans-body {
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 14px 16px;
  font-size: 15px; line-height: 1.8;
  color: var(--txt-1);
  min-height: 48px;
}
.trans-loading { color: var(--txt-4); font-size: 13px; font-style: italic; }
.trans-note {
  margin-top: 6px;
  font-size: 10px; color: var(--txt-4);
  line-height: 1.6; letter-spacing: .1px;
}

/* â”€â”€ STATS SECTION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.stats-sec { margin-top: 20px; padding-top: 18px; border-top: 1px solid var(--border); }
.sec-lbl {
  font-size: 11px; font-weight: 600; color: var(--txt-3);
  text-transform: uppercase; letter-spacing: .8px;
  margin-bottom: 10px;
}
.chips { display: flex; flex-wrap: wrap; gap: 5px; margin-bottom: 10px; }
.chip {
  display: flex; align-items: center; gap: 5px;
  padding: 3px 9px;
  border: 1px solid var(--border);
  border-radius: 6px;
  background: var(--surface);
  font-size: 12px; font-weight: 500;
  color: var(--txt-2);
  transition: border-color .15s;
}
.chip:hover { border-color: #D1D5DB; }
.chip-dot { width: 6px; height: 6px; border-radius: 50%; flex-shrink: 0; }
.chip-num { font-weight: 700; color: var(--txt-1); }
.bar-chart { display: flex; flex-direction: column; gap: 7px; }
.bar-row { display: flex; align-items: center; gap: 10px; }
.bar-lbl {
  font-size: 11px; font-weight: 600; color: var(--txt-2);
  min-width: 96px; text-align: right; white-space: nowrap;
}
.bar-track {
  flex: 1; background: var(--border);
  border-radius: 99px; height: 14px; overflow: hidden;
}
.bar-fill {
  height: 100%; border-radius: 99px;
  animation: barGrow .45s ease forwards;
}
@keyframes barGrow { from { width: 0; } }
.bar-cnt {
  font-size: 11px; font-weight: 700; color: var(--txt-2);
  min-width: 18px; text-align: left;
}
.level-note {
  margin-bottom: 10px;
  font-size: 10px; color: var(--txt-4);
  line-height: 1.6; letter-spacing: .1px;
}

/* â”€â”€ TABLE VIEW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.tok-tbl { width: 100%; border-collapse: collapse; font-size: 13px; }
.tok-tbl th {
  text-align: left; padding: 7px 12px;
  background: var(--bg);
  color: var(--txt-3); font-size: 11px; font-weight: 600;
  letter-spacing: .5px; text-transform: uppercase;
  border-bottom: 1px solid var(--border);
}
.tok-tbl td { padding: 8px 12px; border-bottom: 1px solid var(--bg); color: var(--txt-2); }
.tok-tbl tr:last-child td { border-bottom: none; }
.tok-tbl tr:hover td { background: var(--bg); }
.lv-pill {
  display: inline-block; padding: 2px 7px;
  font-size: 11px; font-weight: 700;
  border-radius: 4px; letter-spacing: .3px;
}
.tbl-sf { font-size: 16px; font-weight: 600; color: var(--txt-1); }

/* â”€â”€ PLACEHOLDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.placeholder {
  display: flex; flex-direction: column; align-items: center;
  justify-content: center; padding: 48px 24px; gap: 10px;
  color: var(--txt-4); text-align: center;
}
.placeholder-icon { font-size: 28px; opacity: .5; }
.placeholder-text { font-size: 13px; color: var(--txt-4); }

/* â”€â”€ ERROR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.error-msg {
  display: flex; align-items: center; gap: 8px;
  padding: 11px 14px;
  background: #FEF2F2; border: 1px solid #FECACA;
  border-radius: 8px;
  color: #DC2626; font-size: 13px;
}

/* â”€â”€ ANIMATIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@keyframes fadeUp {
  from { opacity:0; transform:translateY(6px); }
  to   { opacity:1; transform:translateY(0); }
}
.fade-up { animation: fadeUp .2s ease forwards; }

.tok { animation: tokenIn .18s ease backwards; }
@keyframes tokenIn {
  from { opacity:0; transform:scale(.9); }
  to   { opacity:1; transform:scale(1); }
}

/* â”€â”€ FOOTER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
footer {
  text-align: center; padding: 20px 16px;
  font-size: 11px; color: var(--txt-4);
  border-top: 1px solid var(--border);
  max-width: 800px; margin: 0 auto;
}

/* â”€â”€ RESPONSIVE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@media (max-width: 560px) {
  main { padding: 14px 12px 48px; }
  .card { padding: 16px; }
  .tok-sf { font-size: 14px; }
  .sum-val { font-size: 22px; }
}
</style>
</head>
<body>

<header class="hdr">
  <div class="logo">
    <div class="logo-ico">ğŸ“š</div>
    <span class="logo-name">Voca<span class="logo-dot">Level</span></span>
  </div>
  <div class="hdr-right">
    <button class="icon-btn" id="darkBtn" onclick="toggleTheme()" title="ë‹¤í¬ ëª¨ë“œ">ğŸŒ™</button>
  </div>
</header>

<main>
  <!-- INPUT -->
  <div class="card">
    <div class="lang-tabs">
      <button class="ltab on" id="ltab-auto" onclick="setLang('auto')">ğŸ¤– ìë™ / è‡ªå‹•</button>
      <button class="ltab"    id="ltab-jp"   onclick="setLang('jp')">ğŸ‡¯ğŸ‡µ ì¼ë³¸ì–´ / æ—¥æœ¬èª</button>
      <button class="ltab"    id="ltab-kr"   onclick="setLang('kr')">ğŸ‡°ğŸ‡· í•œêµ­ì–´ / éŸ“å›½èª</button>
    </div>
    <textarea class="inp" id="inp" oninput="cntUpd()"
      placeholder="ë¶„ì„í•  í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš” / åˆ†æã™ã‚‹ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"></textarea>
    <div class="inp-foot">
      <div class="inp-left">
        <span class="char-cnt"><span id="cntN">0</span> ê¸€ì / æ–‡å­—</span>
        <div class="sample-btns">
          <button class="sample-btn" onclick="loadSample('jp')">ğŸ‡¯ğŸ‡µ ìƒ˜í”Œ / ã‚µãƒ³ãƒ—ãƒ«</button>
          <button class="sample-btn" onclick="loadSample('kr')">ğŸ‡°ğŸ‡· ìƒ˜í”Œ / ã‚µãƒ³ãƒ—ãƒ«</button>
        </div>
      </div>
      <button class="btn-go" id="analyzeBtn" onclick="doAnalyze()">
        ë¶„ì„ / åˆ†æ
      </button>
    </div>
  </div>

  <!-- OUTPUT -->
  <div class="card" id="resCard">
    <div class="res-hdr">
      <div>
        <div class="res-title">ë¶„ì„ ê²°ê³¼ / åˆ†æçµæœ</div>
        <div class="res-sub" id="res-sub">í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥ í›„ ë¶„ì„ ë²„íŠ¼ í´ë¦­ / ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦åˆ†æãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯</div>
      </div>
      <div class="res-controls">
        <button class="btn-csv" id="csvBtn" onclick="downloadCSV()" style="display:none">â¬‡ CSV</button>
        <div class="vtoggle" id="vtoggle" style="display:none">
          <button class="vbtn on" id="vbtn-sent" onclick="setView('sent')">ë¬¸ì¥ / æ–‡ç« </button>
          <button class="vbtn"    id="vbtn-tbl"  onclick="setView('tbl')">í‘œ / è¡¨</button>
        </div>
      </div>
    </div>

    <div id="resBody">
      <div class="placeholder">
        <div class="placeholder-icon">ğŸ“</div>
        <div class="placeholder-text">ì¼ë³¸ì–´ ë˜ëŠ” í•œêµ­ì–´ í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥ í›„ ë¶„ì„ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”</div>
        <div class="placeholder-text">æ—¥æœ¬èªã¾ãŸã¯éŸ“å›½èªã®ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦åˆ†æãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„</div>
      </div>
    </div>
  </div>
</main>

<footer>
  VocaLevel v1.0 &nbsp;Â·&nbsp; MeCab + unidic-cwj-202302 / kiwipiepy &nbsp;Â·&nbsp; JLPT &amp; TOPIK ì–´íœ˜ ì°¸ì¡° / èªå½™å‚ç…§ &nbsp;Â·&nbsp; ë¦´ë¦¬ì¦ˆ 2026ë…„ 2ì›” 28ì¼ / ãƒªãƒªãƒ¼ã‚¹ 2026å¹´2æœˆ28æ—¥
</footer>

<script>
/* â”€â”€ í’ˆì‚¬ í•œÂ·ì¼ ë³‘ìš© ë¼ë²¨ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const POS_BILINGUAL = {
  // ì¼ë³¸ì–´ unidic
  'åè©':'ëª…ì‚¬ / åè©',       'å‹•è©':'ë™ì‚¬ / å‹•è©',
  'å½¢å®¹è©':'í˜•ìš©ì‚¬ / å½¢å®¹è©', 'å½¢çŠ¶è©':'í˜•ìƒì‚¬ / å½¢çŠ¶è©',
  'å‰¯è©':'ë¶€ì‚¬ / å‰¯è©',       'åŠ©è©':'ì¡°ì‚¬ / åŠ©è©',
  'åŠ©å‹•è©':'ì¡°ë™ì‚¬ / åŠ©å‹•è©', 'æ¥ç¶šè©':'ì ‘ì†ì‚¬ / æ¥ç¶šè©',
  'æ„Ÿå‹•è©':'ê°ë™ì‚¬ / æ„Ÿå‹•è©', 'è¨˜å·':'ê¸°í˜¸ / è¨˜å·',
  'è£œåŠ©è¨˜å·':'ë³´ì¡°ê¸°í˜¸ / è£œåŠ©è¨˜å·', 'æ¥é ­è¾':'ì ‘ë‘ì‚¬ / æ¥é ­è¾',
  'æ¥å°¾è¾':'ì ‘ë¯¸ì‚¬ / æ¥å°¾è¾', 'ä»£åè©':'ëŒ€ëª…ì‚¬ / ä»£åè©',
  'ç©ºç™½':'ê³µë°± / ç©ºç™½',
  // í•œêµ­ì–´
  'NNG':'ì¼ë°˜ëª…ì‚¬ / æ™®é€šåè©', 'NNP':'ê³ ìœ ëª…ì‚¬ / å›ºæœ‰åè©',
  'NNB':'ì˜ì¡´ëª…ì‚¬ / ä¾å­˜åè©', 'NR':'ìˆ˜ì‚¬ / æ•°è©',
  'NP':'ëŒ€ëª…ì‚¬ / ä»£åè©',      'VV':'ë™ì‚¬ / å‹•è©',
  'VA':'í˜•ìš©ì‚¬ / å½¢å®¹è©',      'VX':'ë³´ì¡°ìš©ì–¸ / è£œåŠ©ç”¨è¨€',
  'VCP':'ì§€ì •ì‚¬ / æŒ‡å®šè©',     'VCN':'ì§€ì •ì‚¬ / æŒ‡å®šè©',
  'MM':'ê´€í˜•ì‚¬ / å† å½¢è©',      'MAG':'ë¶€ì‚¬ / å‰¯è©',
  'MAJ':'ì ‘ì†ë¶€ì‚¬ / æ¥ç¶šå‰¯è©', 'IC':'ê°íƒ„ì‚¬ / æ„Ÿå˜†è©',
  'JKS':'ì£¼ê²©ì¡°ì‚¬ / ä¸»æ ¼åŠ©è©', 'JKC':'ë³´ê²©ì¡°ì‚¬ / è£œæ ¼åŠ©è©',
  'JKG':'ê´€í˜•ê²©ì¡°ì‚¬ / å±æ ¼åŠ©è©','JKO':'ëª©ì ê²©ì¡°ì‚¬ / ç›®çš„æ ¼åŠ©è©',
  'JKB':'ë¶€ì‚¬ê²©ì¡°ì‚¬ / å‰¯è©æ ¼åŠ©è©','JKV':'í˜¸ê²©ì¡°ì‚¬ / å‘¼æ ¼åŠ©è©',
  'JKQ':'ì¸ìš©ê²©ì¡°ì‚¬ / å¼•ç”¨åŠ©è©','JX':'ë³´ì¡°ì‚¬ / è£œåŠ©åŠ©è©',
  'JC':'ì ‘ì†ì¡°ì‚¬ / æ¥ç¶šåŠ©è©',
  'EP':'ì„ ì–´ë§ì–´ë¯¸ / èªå¹¹æœ«èªå°¾','EF':'ì¢…ê²°ì–´ë¯¸ / çµ‚çµèªå°¾',
  'EC':'ì—°ê²°ì–´ë¯¸ / é€£çµèªå°¾',   'ETN':'ëª…ì‚¬í˜•ì–´ë¯¸ / åè©å‹èªå°¾',
  'ETM':'ê´€í˜•í˜•ì–´ë¯¸ / å† å½¢å‹èªå°¾',
  'XPN':'ì ‘ë‘ì‚¬ / æ¥é ­è¾',     'XSN':'ëª…ì‚¬ì ‘ë¯¸ì‚¬ / åè©æ¥å°¾è¾',
  'XSV':'ë™ì‚¬ì ‘ë¯¸ì‚¬ / å‹•è©æ¥å°¾è¾','XSA':'í˜•ìš©ì‚¬ì ‘ë¯¸ì‚¬ / å½¢å®¹è©æ¥å°¾è¾',
  'XR':'ì–´ê·¼ / èªæ ¹',
  'SF':'ë§ˆì¹¨í‘œ / å¥ç‚¹',   'SP':'ì‰¼í‘œ / èª­ç‚¹',
  'SS':'ë”°ì˜´í‘œ / å¼•ç”¨ç¬¦', 'SE':'ì¤„ì„í‘œ / çœç•¥å·',
  'SO':'ë¶™ì„í‘œ / é€£çµç¬¦', 'SW':'ê¸°íƒ€ê¸°í˜¸ / ãã®ä»–è¨˜å·',
  'SB':'ìˆœì„œê¸°í˜¸ / é †åºè¨˜å·','SL':'ì™¸êµ­ì–´ / å¤–æ¥èª',
  'SH':'í•œì / æ¼¢å­—',     'SN':'ìˆ˜ / æ•°å­—',
  // kiwipiepy í’ˆì‚¬ í•œê¸€ ë ˆì´ë¸”
  'ëª…ì‚¬':'ëª…ì‚¬ / åè©', 'ê³ ìœ ëª…ì‚¬':'ê³ ìœ ëª…ì‚¬ / å›ºæœ‰åè©',
  'ë™ì‚¬':'ë™ì‚¬ / å‹•è©', 'í˜•ìš©ì‚¬':'í˜•ìš©ì‚¬ / å½¢å®¹è©',
  'ë¶€ì‚¬':'ë¶€ì‚¬ / å‰¯è©', 'ì¡°ì‚¬':'ì¡°ì‚¬ / åŠ©è©',
  'ì–´ë¯¸':'ì–´ë¯¸ / èªå°¾', 'ì§€ì •ì‚¬':'ì§€ì •ì‚¬ / æŒ‡å®šè©',
  'ë³´ì¡°ìš©ì–¸':'ë³´ì¡°ìš©ì–¸ / è£œåŠ©ç”¨è¨€', 'ê°íƒ„ì‚¬':'ê°íƒ„ì‚¬ / æ„Ÿå˜†è©',
  'ì ‘ë‘ì‚¬':'ì ‘ë‘ì‚¬ / æ¥é ­è¾', 'ì ‘ë¯¸ì‚¬':'ì ‘ë¯¸ì‚¬ / æ¥å°¾è¾',
  'ê¸°í˜¸':'ê¸°í˜¸ / è¨˜å·', 'ìˆ«ì':'ìˆ«ì / æ•°å­—',
  'ì™¸êµ­ì–´':'ì™¸êµ­ì–´ / å¤–æ¥èª', 'í•œì':'í•œì / æ¼¢å­—',
};

/* â”€â”€ ë ˆë²¨ ë¼ë²¨ í•œÂ·ì¼ ë³‘ìš© â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const LV_DISPLAY = {
  'ì¡°ì‚¬':'ì¡°ì‚¬ / åŠ©è©',         'åŠ©è©':'ì¡°ì‚¬ / åŠ©è©',
  'ì¡°ë™ì‚¬':'ì¡°ë™ì‚¬ / åŠ©å‹•è©',   'åŠ©å‹•è©':'ì¡°ë™ì‚¬ / åŠ©å‹•è©',
  'ê¸°í˜¸':'ê¸°í˜¸ / è¨˜å·',         'è¨˜å·':'ê¸°í˜¸ / è¨˜å·',
  'ë¯¸ë“±ì¬':'ë¯¸ë“±ë¡ / æœªç™»éŒ²',   'æœªç™»éŒ²':'ë¯¸ë“±ë¡ / æœªç™»éŒ²',
};

function getPOS(pos) { return POS_BILINGUAL[pos] || pos; }
function getLv(lv)   { return LV_DISPLAY[lv]     || lv; }

const SAMPLES = {
  jp: 'ç§ã¯æ¯æ—¥æ±äº¬ã®å¤§å­¦ã§æ—¥æœ¬èªã¨éŸ“å›½èªã‚’å‹‰å¼·ã—ã¦ã„ã¾ã™ã€‚',
  kr: 'ì €ëŠ” ë§¤ì¼ ì„œìš¸ì—ì„œ í•œêµ­ì–´ì™€ ì¼ë³¸ì–´ë¥¼ ê³µë¶€í•˜ê³  ìˆì–´ìš”.',
};
const LV_CLS = {
  'N5':'lN5','N4':'lN4','N3':'lN3','N2':'lN2','N1':'lN1',
  '1ê¸‰':'lT1','2ê¸‰':'lT2','3ê¸‰':'lT3','4ê¸‰':'lT4','5ê¸‰':'lT5','6ê¸‰':'lT6',
};
const LV_COLOR = {
  'N5':'#16A34A','N4':'#65A30D','N3':'#D97706','N2':'#EA580C','N1':'#DC2626',
  '1ê¸‰':'#16A34A','2ê¸‰':'#65A30D','3ê¸‰':'#D97706','4ê¸‰':'#EA580C','5ê¸‰':'#DC2626','6ê¸‰':'#9333EA',
};
const LV_BG = {
  'N5':'#F0FDF4','N4':'#F7FEE7','N3':'#FFFBEB','N2':'#FFF7ED','N1':'#FEF2F2',
  '1ê¸‰':'#F0FDF4','2ê¸‰':'#F7FEE7','3ê¸‰':'#FFFBEB','4ê¸‰':'#FFF7ED','5ê¸‰':'#FEF2F2','6ê¸‰':'#FAF5FF',
};
const JP_ORDER = ['N5','N4','N3','N2','N1'];
const KR_ORDER = ['1ê¸‰','2ê¸‰','3ê¸‰','4ê¸‰','5ê¸‰','6ê¸‰'];

let currentLang = 'auto', currentView = 'sent', darkMode = false;
let lastResult = null, lastOriginalText = '', lastTranslation = null;

function setLang(lang) {
  currentLang = lang;
  ['auto','jp','kr'].forEach(l => document.getElementById(`ltab-${l}`).classList.remove('on'));
  document.getElementById(`ltab-${lang}`).classList.add('on');
}
function setView(v) {
  currentView = v;
  ['sent','tbl'].forEach(x => document.getElementById(`vbtn-${x}`).classList.remove('on'));
  document.getElementById(`vbtn-${v}`).classList.add('on');
  if (lastResult) renderResult(lastResult);
}
function toggleTheme() {
  darkMode = !darkMode;
  const r = document.documentElement;
  if (darkMode) {
    r.style.setProperty('--bg',      '#111827');
    r.style.setProperty('--surface', '#1F2937');
    r.style.setProperty('--border',  '#374151');
    r.style.setProperty('--txt-1',   '#F9FAFB');
    r.style.setProperty('--txt-2',   '#E5E7EB');
    r.style.setProperty('--txt-3',   '#9CA3AF');
    r.style.setProperty('--txt-4',   '#6B7280');
    r.style.setProperty('--accent-bg','rgba(99,102,241,.15)');
    document.getElementById('darkBtn').textContent = 'â˜€ï¸';
  } else {
    r.style.setProperty('--bg',      '#F8F9FA');
    r.style.setProperty('--surface', '#FFFFFF');
    r.style.setProperty('--border',  '#E5E7EB');
    r.style.setProperty('--txt-1',   '#111827');
    r.style.setProperty('--txt-2',   '#374151');
    r.style.setProperty('--txt-3',   '#6B7280');
    r.style.setProperty('--txt-4',   '#9CA3AF');
    r.style.setProperty('--accent-bg','rgba(99,102,241,.07)');
    document.getElementById('darkBtn').textContent = 'ğŸŒ™';
  }
}
function cntUpd() {
  document.getElementById('cntN').textContent = document.getElementById('inp').value.length;
}
function loadSample(lang) {
  document.getElementById('inp').value = SAMPLES[lang]; cntUpd(); setLang(lang);
}

/* â”€â”€ ë¶„ì„ ì‹¤í–‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function doAnalyze() {
  const text = document.getElementById('inp').value.trim();
  if (!text) { showError('í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš” / ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }

  const btn = document.getElementById('analyzeBtn');
  btn.disabled = true;
  btn.innerHTML = '<div class="spinner"></div> ë¶„ì„ ì¤‘ / è§£æä¸­...';
  document.getElementById('resBody').innerHTML =
    '<div class="placeholder"><div class="placeholder-icon">â³</div>' +
    '<div class="placeholder-text">í˜•íƒœì†Œ ë¶„ì„ ì¤‘ / å½¢æ…‹ç´ è§£æä¸­...</div></div>';
  document.getElementById('vtoggle').style.display = 'none';
  document.getElementById('csvBtn').style.display = 'none';
  document.getElementById('res-sub').textContent = '';
  lastTranslation = null;

  try {
    const resp = await fetch('/api/analyze', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ text, lang: currentLang }),
    });
    const data = await resp.json();
    if (!resp.ok) throw new Error(data.error || 'Server error');
    lastResult = data;
    lastOriginalText = text;
    renderResult(data);
    document.getElementById('vtoggle').style.display = 'flex';
    document.getElementById('csvBtn').style.display = 'flex';
  } catch (e) {
    showError(e.message);
  } finally {
    btn.disabled = false;
    btn.innerHTML = 'ë¶„ì„ / åˆ†æ';
  }
}

function showError(msg) {
  document.getElementById('resBody').innerHTML =
    `<div class="error-msg">âš ï¸ ${msg}</div>`;
}

/* â”€â”€ ê²°ê³¼ ë Œë”ë§ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function renderResult(data) {
  const { detected_lang, tokens, stats } = data;
  const isJP     = detected_lang === 'ja';
  const order    = isJP ? JP_ORDER : KR_ORDER;
  const langLabel = isJP ? 'ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª / ì¼ë³¸ì–´' : 'ğŸ‡°ğŸ‡· í•œêµ­ì–´ / éŸ“å›½èª';
  const refLabel  = isJP ? 'JLPT ê¸°ì¤€ / JLPTåŸºæº–' : 'TOPIK ê¸°ì¤€ / TOPIKåŸºæº–';
  const maxColor  = LV_COLOR[stats.max_level] || '#6366F1';

  document.getElementById('res-sub').textContent = 'í† í° ìœ„ì— ì»¤ì„œë¥¼ ì˜¬ë¦¬ë©´ ìƒì„¸ ì •ë³´ í‘œì‹œ / ãƒˆãƒ¼ã‚¯ãƒ³ã«ã‚«ãƒ¼ã‚½ãƒ«ã‚’åˆã‚ã›ã‚‹ã¨è©³ç´°è¡¨ç¤º';

  let html = `
    <div class="detect-badge fade-up">
      <b>${langLabel}</b>
      <span class="dot-sep">Â·</span>
      <span>${refLabel} ì–´íœ˜ ë¶„ì„ / èªå½™åˆ†æ</span>
    </div>
    <div class="sum-row fade-up">
      <div class="sum-card">
        <div class="sum-val">${stats.total}</div>
        <div class="sum-lbl">ì „ì²´ í† í°<br>å…¨ãƒˆãƒ¼ã‚¯ãƒ³</div>
      </div>
      <div class="sum-card">
        <div class="sum-val">${stats.content_words}</div>
        <div class="sum-lbl">ë‚´ìš©ì–´<br>å†…å®¹èª</div>
      </div>
      <div class="sum-card">
        <div class="sum-val">${stats.in_list}</div>
        <div class="sum-lbl">ì‚¬ì „ ì¼ì¹˜<br>è¾æ›¸ä¸€è‡´</div>
      </div>
      <div class="sum-card">
        <div class="sum-val level" style="color:${maxColor}">${stats.max_level}</div>
        <div class="sum-lbl">ìµœê³  ë ˆë²¨<br>æœ€é«˜ãƒ¬ãƒ™ãƒ«</div>
      </div>
    </div>`;

  html += currentView === 'sent' ? buildSentView(tokens, isJP) : buildTableView(tokens, isJP);
  html += buildTranslationSection(isJP);
  html += buildStats(stats, order);

  document.getElementById('resBody').innerHTML = html;
  document.querySelectorAll('.tok').forEach((el, i) => {
    el.style.animationDelay = `${i * 22}ms`;
  });

  // ë²ˆì—­ ë¹„ë™ê¸° ë¡œë“œ
  loadTranslation(detected_lang);
}

/* â”€â”€ ë²ˆì—­ ì„¹ì…˜ HTML â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function buildTranslationSection(isJP) {
  const label = isJP
    ? 'ğŸ‡°ğŸ‡· í•œêµ­ì–´ ë²ˆì—­ / éŸ“å›½èªç¿»è¨³'
    : 'ğŸ‡¯ğŸ‡µ ì¼ë³¸ì–´ ë²ˆì—­ / æ—¥æœ¬èªç¿»è¨³';
  return `
    <div class="trans-sec fade-up">
      <div class="sec-lbl">${label}</div>
      <div class="trans-body">
        <span id="transBody" class="trans-loading">ë²ˆì—­ ì¤‘ / ç¿»è¨³ä¸­â€¦</span>
      </div>
      <div class="trans-note">
        ë²ˆì—­ ì œê³µ: Google ë²ˆì—­ (ë¬´ë£Œ) &nbsp;/&nbsp; ç¿»è¨³æä¾›: Googleç¿»è¨³ï¼ˆç„¡æ–™ï¼‰<br>
        ë²ˆì—­ ê²°ê³¼ëŠ” ì°¸ê³ ìš©ì´ë©° ì‹¤ì œ ì˜ë¯¸ì™€ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. &nbsp;/&nbsp; ç¿»è¨³çµæœã¯å‚è€ƒç”¨ã§ã‚ã‚Šã€å®Ÿéš›ã®æ„å‘³ã¨ç•°ãªã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚
      </div>
    </div>`;
}

/* â”€â”€ Google Translate í˜¸ì¶œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function fetchGoogleTranslation(text, fromLang) {
  const toLang = fromLang === 'ja' ? 'ko' : 'ja';
  const url = `https://translate.googleapis.com/translate_a/single?client=gtx&sl=${fromLang}&tl=${toLang}&dt=t&q=${encodeURIComponent(text)}`;
  const resp = await fetch(url);
  if (!resp.ok) throw new Error('Translation request failed');
  const data = await resp.json();
  return data[0].map(seg => seg[0]).join('');
}

async function loadTranslation(lang) {
  const el = document.getElementById('transBody');
  if (!el) return;

  // ìºì‹œëœ ë²ˆì—­ ì‚¬ìš© (ë·° í† ê¸€ ì‹œ ì¬í™œìš©)
  if (lastTranslation !== null) {
    el.className = '';
    el.textContent = lastTranslation;
    return;
  }

  try {
    const translated = await fetchGoogleTranslation(lastOriginalText, lang);
    lastTranslation = translated;
    const el2 = document.getElementById('transBody');
    if (el2) { el2.className = ''; el2.textContent = translated; }
  } catch (e) {
    const el2 = document.getElementById('transBody');
    if (el2) { el2.className = 'trans-loading'; el2.textContent = 'ë²ˆì—­ ë¶ˆê°€ / ç¿»è¨³ä¸å¯'; }
  }
}

/* â”€â”€ CSV ë‹¤ìš´ë¡œë“œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function downloadCSV() {
  if (!lastResult) return;
  const { detected_lang, tokens } = lastResult;
  const isJP = detected_lang === 'ja';

  const headers = isJP
    ? ['í‘œì¸µí˜•', 'ì½ê¸°', 'ê¸°ë³¸í˜•', 'í’ˆì‚¬', 'ë ˆë²¨', 'ì‚¬ì „ì¼ì¹˜']
    : ['í‘œì¸µí˜•', 'ê¸°ë³¸í˜•', 'í’ˆì‚¬', 'ë ˆë²¨', 'ì‚¬ì „ì¼ì¹˜'];

  const rows = tokens.map(t => isJP
    ? [t.surface, t.reading, t.base_form, t.pos, t.level, t.in_list ? 'O' : '']
    : [t.surface, t.base_form, t.pos, t.level, t.in_list ? 'O' : '']
  );

  const esc = v => `"${String(v).replace(/"/g, '""')}"`;
  const csv = [headers, ...rows].map(row => row.map(esc).join(',')).join('\n');

  // UTF-8 BOM ì¶”ê°€ (Excel í•œê¸€/ì¼ë³¸ì–´ ê¹¨ì§ ë°©ì§€)
  const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
  const url  = URL.createObjectURL(blob);
  const a    = document.createElement('a');
  a.href = url;
  a.download = `vocalevel_${detected_lang}_${new Date().toISOString().slice(0,10)}.csv`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}

/* â”€â”€ ë¬¸ì¥ ë·° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function buildSentView(tokens, isJP) {
  let html = '<div class="tok-wrap fade-up">';
  tokens.forEach(t => {
    const cls = LV_CLS[t.level] || (t.is_grammar ? 'lGR' : 'lUK');
    const col = LV_COLOR[t.level] || (t.is_grammar ? '#6B7280' : '#9CA3AF');
    const rdRow = isJP && t.reading
      ? `<div class="ttp-row"><span class="ttp-k">èª­ã¿ / ì½ê¸°</span><span class="ttp-v">${t.reading}</span></div>` : '';
    const lvDisplay = t.in_list ? getLv(t.level) : 'â€”';
    html += `
      <div class="tok ${cls}">
        <div class="tok-sf">${t.surface}</div>
        ${isJP && t.reading ? `<div class="tok-rd">${t.reading}</div>` : '<div class="tok-rd"></div>'}
        <div class="tok-lv">${lvDisplay}</div>
        <div class="tok-pos">${getPOS(t.pos)}</div>
        <div class="ttp">
          ${rdRow}
          <div class="ttp-row"><span class="ttp-k">ê¸°ë³¸í˜• / åŸºæœ¬å½¢</span><span class="ttp-v">${t.base_form}</span></div>
          <div class="ttp-row"><span class="ttp-k">í’ˆì‚¬ / å“è©</span><span class="ttp-v">${getPOS(t.pos)}</span></div>
          <div class="ttp-row"><span class="ttp-k">ë ˆë²¨ / ãƒ¬ãƒ™ãƒ«</span><span class="ttp-v" style="color:${col}">${getLv(t.level)}</span></div>
        </div>
      </div>`;
  });
  return html + '</div>';
}

/* â”€â”€ í‘œ ë·° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function buildTableView(tokens, isJP) {
  const rdCol = isJP ? '<th>ì½ê¸° / èª­ã¿</th>' : '';
  let html = `
    <table class="tok-tbl fade-up">
      <thead><tr><th>#</th><th>í† í° / ãƒˆãƒ¼ã‚¯ãƒ³</th>${rdCol}<th>í’ˆì‚¬ / å“è©</th><th>ê¸°ë³¸í˜• / åŸºæœ¬å½¢</th><th>ë ˆë²¨ / ãƒ¬ãƒ™ãƒ«</th></tr></thead>
      <tbody>`;
  tokens.forEach((t, i) => {
    const col = LV_COLOR[t.level] || '#9CA3AF';
    const bg  = LV_BG[t.level]   || '#F9FAFB';
    const rdCell = isJP ? `<td>${t.reading || 'â€”'}</td>` : '';
    html += `<tr>
      <td style="color:var(--txt-4);font-size:12px">${i + 1}</td>
      <td class="tbl-sf">${t.surface}</td>
      ${rdCell}
      <td>${getPOS(t.pos)}</td>
      <td>${t.base_form}</td>
      <td><span class="lv-pill" style="background:${bg};color:${col}">${getLv(t.level)}</span></td>
    </tr>`;
  });
  return html + '</tbody></table>';
}

/* â”€â”€ ë ˆë²¨ ë¶„í¬ ë°” ì°¨íŠ¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function buildStats(stats, order) {
  const counts = stats.by_level;
  const maxCount = Math.max(...Object.values(counts));
  const levelRows = order.filter(lv => counts[lv]);
  const miscRows  = Object.keys(counts).filter(lv => !order.includes(lv)).sort();
  const rows = [...levelRows, ...miscRows];

  const isJP = order === JP_ORDER;
  const levelNote = isJP
    ? 'JLPT: N5 (ì´ˆê¸‰ / åˆç´š) â†’ N1 (ê³ ê¸‰ / ä¸Šç´š) &nbsp;Â·&nbsp; ìˆ«ìê°€ ì‘ì„ìˆ˜ë¡ ê³ ê¸‰ ìˆ˜ì¤€ / æ•°å­—ãŒå°ã•ã„ã»ã©ä¸Šç´šãƒ¬ãƒ™ãƒ«'
    : 'TOPIK: 1ê¸‰ (ì´ˆê¸‰ / åˆç´š) â†’ 6ê¸‰ (ê³ ê¸‰ / ä¸Šç´š) &nbsp;Â·&nbsp; ìˆ«ìê°€ í´ìˆ˜ë¡ ê³ ê¸‰ ìˆ˜ì¤€ / æ•°å­—ãŒå¤§ãã„ã»ã©ä¸Šç´šãƒ¬ãƒ™ãƒ«';

  let bars = '';
  rows.forEach(lv => {
    const cnt = counts[lv];
    const col = LV_COLOR[lv] || '#9CA3AF';
    const pct = (cnt / maxCount * 100).toFixed(1);
    bars += `<div class="bar-row">
      <div class="bar-lbl">${getLv(lv)}</div>
      <div class="bar-track">
        <div class="bar-fill" style="width:${pct}%;background:${col}"></div>
      </div>
      <div class="bar-cnt">${cnt}</div>
    </div>`;
  });

  return `
    <div class="stats-sec fade-up">
      <div class="sec-lbl">ë ˆë²¨ ë¶„í¬ / ãƒ¬ãƒ™ãƒ«åˆ†å¸ƒ</div>
      <div class="level-note">${levelNote}</div>
      <div class="bar-chart">${bars}</div>
    </div>`;
}

cntUpd();
</script>
</body>
</html>
